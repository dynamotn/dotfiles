#!{{ lookPath "bash" }}
set -Eeou pipefail
source {{ .chezmoi.sourceDir }}/../scripts/lib/message.sh
trap "_error \"Can't setup fish shell\"" ERR

_notice "Setup fish shell"
# plugins hash: {{ joinPath .chezmoi.sourceDir "../silos/fish/fish_plugins" | include | sha256sum }}
if [[ $SHELL != "$(which fish)" ]]; then
  _info "Change default shell to fish"
  {{- if eq .chezmoi.os "linux" }}
  sudo chsh -s "$(which fish)"
  {{- else if eq .chezmoi.os "darwin" }}
  echo "$(which fish)" | sudo tee -a /etc/shells
  chsh -s "$(which fish)" || :
  {{- else }}
  chsh -s fish
  {{- end }}
fi
fish {{ .chezmoi.homeDir }}/.config/fish/setup.fish

_progress "Install neccessary tools"
mkdir -p ~/.config/fish/completions && ln -sf ~/.asdf/completions/asdf.fish ~/.config/fish/completions/asdf.fish
~/.fzf/install --no-zsh --no-fish --bin
_success "Setup fish shell"
