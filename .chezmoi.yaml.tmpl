encryption: age
format: yaml
mode: symlink
{{- if stdinIsATTY }}
progress: true
{{- end }}

# Uncomment the following line to set umask for MacOS root system
# umask: 0o02

add:
  templateSymlinks: true

diff:
  pager: delta --pager="ov -F --section-delimiter '^(added:|removed:|renamed:|Δ)' --section-header --pattern '•'"

data:
  {{- $osid := .chezmoi.os }}
  {{- if hasKey .chezmoi.osRelease "id" }}
  {{-   $osid = printf "%s-%s" .chezmoi.os .chezmoi.osRelease.id }}
  {{- end }}
  osid: {{ $osid | quote }}
  {{- if eq $osid "android" }}
  initSystem: "termux"
  {{- else if eq $osid "darwin" }}
  initSystem: "launchd"
  {{- else if eq $osid "linux-gentoo" }}
  {{-   $initCommand := output "/usr/bin/ps" "-p" "1" "-o" "comm=" | trim }}
  {{-   if eq $initCommand "init" }}
  initSystem: "openrc"
  {{-   else }}
  initSystem: "systemd"
  {{-   end }}
  {{- else if eq $osid "linux-alpine" }}
  initSystem: "openrc"
  {{- else }}
  initSystem: "systemd"
  {{- end }}
  {{- if eq .chezmoi.os "android" }}
  bash: {{ lookPath "bash" | quote }}
  {{- else }}
  bash: "/usr/bin/env bash"
  {{- end }}

  {{- $places := list "cloud" "home" "office" "mobility" }}
  {{- $place := promptChoiceOnce . "place" "Where does this machine place" $places (first $places) }}
  place: {{ $place | quote }}
  {{- $kinds := list "container" "pc" "laptop" "workstation" "tablet" "mobile" "vm" "sbc" }}
  {{- $kind := promptChoiceOnce . "kind" "What kind of this machine is it" $kinds (first $kinds) }}
  kind: {{ $kind | quote }}

  {{- $companies := list "F1" "T1" "ZOO" }}
  code: {{ promptStringOnce . "code" "What is this machine's name" "t00lb0x" | quote }}
  {{- if eq $place "office" }}
  company: {{ promptChoiceOnce . "company" "What code of owner company is" $companies (first $companies) | quote }}
  {{- else }}
  company:
  {{- end }}

  {{- $decryptPersonal := promptBoolOnce . "decryptPersonal" "Do you want to decrypt personal's secrets (y/n)" false }}
  decryptPersonal: {{ $decryptPersonal }}
  {{- $decryptEnterprise := promptMultichoiceOnce . "decryptEnterprise" "Which company's secrets do you want to decrypt" $companies list }}
  {{- if $decryptEnterprise }}
  decryptEnterprise:
    {{ toYaml $decryptEnterprise | indent 4 | trim }}
  {{- else }}
  decryptEnterprise: []
  {{- end }}

  {{- $guiServers := list "0" "W" "X" "M" }}
  {{- $guiServer := promptChoiceOnce . "guiServer" "Which GUI server of this machine is (W for Wayland, X for XOrg, M for Mac, 0 for CLI-only)" $guiServers (first $guiServers) }}
  guiServer: {{ $guiServer | quote }}
  {{- $guiDrivers := list "N" "I" "A" "M" "V" }}
  {{- $guiDriver := "" }}
  {{- $guiWinManagers := list "H" "A" "G" }}
  {{- $guiWinManager := "" }}
  {{- if ne $guiServer "0" }}
  {{-   $guiDriver = promptChoiceOnce . "guiDriver" "Which GUI video driver of this machine is (N for Nvidia, I for Intel, A for AMD, M for Mac, V for virtual)" $guiDrivers }}
  {{-   $guiWinManager = promptChoiceOnce . "guiWinManager" "Which GUI window manager of this machine is (A for aerospace, H for hyprland, G for gnome)" $guiWinManagers (first $guiWinManagers) }}
  {{- end }}
  guiDriver: {{ $guiDriver | quote }}
  guiWinManager: {{ $guiWinManager | quote }}

  {{- $languages := list }}
  {{- if ne $guiServer "0" }}
  {{-   $supportedLanguages := list "vi" "ja" "zh" }}
  {{-   $languages = promptMultichoiceOnce . "languages" "Which company's secrets do you want to decrypt" $supportedLanguages list }}
  {{- end }}
  {{- if $languages }}
  languages:
    {{ toYaml $languages | indent 4 | trim }}
  {{- else }}
  languages: []
  {{- end }}

  {{- if ne $guiServer "0" }}
  {{-   $browsers := list "Z" "F" "" }}
  browser: {{ promptChoiceOnce . "browser" "What web browser do you use (F for Firefox, Z for Zen Browser, or empty)" $browsers (first $browsers) | quote }}
  {{-   $browserEnterpriseProfiles := promptMultichoiceOnce . "browserEnterpriseProfiles" "Which company's browser profiles do you want to decrypt" $decryptEnterprise list }}
  {{-   if $browserEnterpriseProfiles }}
  browserEnterpriseProfiles:
    {{ toYaml $browserEnterpriseProfiles | indent 4 | trim }}
  {{-   else }}
  browserEnterpriseProfiles: []
  {{-   end }}
  {{- end }}

  {{- if ne $guiServer "0" }}
  {{-   $mailClients := list "B" "T" "" }}
  mailClient: {{ promptChoiceOnce . "mailClient" "What email client do you use (T for Thunderbird, B for Betterbird, or empty)" $mailClients (first $mailClients) | quote }}
  {{-  $mailEnterpriseProfiles := promptMultichoiceOnce . "mailEnterpriseProfiles" "Which company's mail profiles do you want to decrypt" $decryptEnterprise list }}
  {{-   if $mailEnterpriseProfiles }}
  mailEnterpriseProfiles:
    {{ toYaml $mailEnterpriseProfiles | indent 4 | trim }}
  {{-   else }}
  mailEnterpriseProfiles: []
  {{-   end }}
  {{- end }}

  {{- $terminalMultiplexers := list "Z" "T" }}
  terminalMultiplexer: {{ promptChoiceOnce . "terminalMultiplexer" "What terminal multiplexer do you use (T for tmux, Z for Zellij)" $terminalMultiplexers (first $terminalMultiplexers) | quote }}

  {{- /**/}}
  hasSound: {{ promptBoolOnce . "hasSound" "Does this machine has a sound card (y/n)" false }}
  hasBluetooth: {{ promptBoolOnce . "hasBluetooth" "Does this machine has a bluetooth device (y/n)" false }}
  hasWifi: {{ promptBoolOnce . "hasWifi" "Does this machine has a wifi device (y/n)" false }}

  {{- $httpProxy := promptStringOnce . "httpProxy" "Fill HTTP(S) proxy address, empty for not using" }}
  {{- $socksProxy := promptStringOnce . "socksProxy" "Fill SOCKS proxy address, empty for not using" }}
  httpProxy: {{ $httpProxy | quote }}
  socksProxy: {{ $socksProxy | quote }}
  {{- if or $httpProxy $socksProxy }}
  noProxyAddresses:
    {{- $isEnd := false }}
    {{- range until 1000 }}
    {{-   $address := promptString "Fill address that not use proxy (empty to end this list)" }}
    {{-  if $address }}
    - {{ $address }}
    {{-  else }}
    {{-    break }}
    {{-  end }}
    {{- end }}
  {{- else }}
  noProxyAddresses: []
  {{- end }}
  preferGitSSH: {{ promptBoolOnce . "preferGitSSH" "Do you want to prefer SSH than HTTPS for git (y/n)" false }}
  blockedGitlab: {{ promptBoolOnce . "blockedGitlab" "Is this machines blocked to access Gitlab (y/n)" false }}

  {{- /**/}}
  darkMode: {{ promptBoolOnce . "darkMode" "Do you want to use dark mode (y/n)" true }}

age:
  identities:
    {{- if $decryptPersonal }}
    - {{ .chezmoi.homeDir }}/.config/chezmoi/personal.key
    {{- end }}
    {{-  range $decryptEnterprise }}
    - {{ $.chezmoi.homeDir }}/.config/chezmoi/enterprise-{{ . }}.key
    {{-  end }}
  recipients:
    {{- if $decryptPersonal }}
    - age1fzajmt2yy4naas2wtcn3v2vjea3f5rgvmz2elp02zvvmdtcgwcdsqxnd5a
    {{- end }}
    {{- range $decryptEnterprise }}
    {{-   if eq . "F1" }}
    - age1t7nuzf3ys4890tn8frjk2mtalkhy3kyr0dqeajk7pn6fjnag6fys85fm39
    {{-   else if eq . "ZOO" }}
    - age1xudykg8zjf4llnzlhre8jducx3sz02fu6p46v8gp05psvkrhvamqq658aa
    {{-   else if eq . "T1" }}
    - age1ghq8xs3k044utwa4kwspupmfx0u4n67qfjnpvnerf2hfd0gyt4eqxhq6xz
    {{-   end }}
    {{- end }}
