[env]
DOCKER_IMAGE = "registry.gitlab.com/dynamo-config/dotfiles"

[tasks.docker-enterprise-F1]
run = """
#!/usr/bin/env bash
docker build --network=host --build-arg \
  SSL_CERT="$(\
    age -d -i ~/.config/chezmoi/enterprise-F1.key \
      root/etc/ca-certificates/trust-source/anchors/encrypted_ssl_decryption.crt.age
  )" \
  --build-arg AGE_PASSPHRASE="$(rbw get 'Age Dotfiles')" \
  --build-arg GITHUB_TOKEN="$GITHUB_TOKEN" \
  --build-arg IDENTITIES="F1" \
  --no-cache \
  -f "{{ config_root }}/docker/Dockerfile.alpine" \
  -t $DOCKER_IMAGE "{{ config_root }}"
"""

[tasks.docker-personal]
run = """
#!/usr/bin/env bash
docker build --network=host \
  --build-arg AGE_PASSPHRASE="$(rbw get 'Age Dotfiles')" \
  --build-arg GITHUB_TOKEN="$GITHUB_TOKEN" \
  --build-arg IDENTITIES="personal" \
  --no-cache \
  -f "{{ config_root }}/docker/Dockerfile.alpine" \
  -t $DOCKER_IMAGE "{{ config_root }}"
"""

[tasks.docker-ci]
run = """
#!/usr/bin/env bash
docker build --network=host \
  --build-arg GITHUB_TOKEN="$GITHUB_TOKEN" \
  --no-cache \
  -f "{{ config_root }}/docker/Dockerfile.alpine" \
  -t $DOCKER_IMAGE "{{ config_root }}"
"""
